battle_condition_miscommunication = {
	icon = "gfx/interface/icons/goods_icons/telephones.dds"

	modifier = {
		unit_morale_loss_mult = 0.1
	}

	possible = {
		always = yes
	}

	weight = {
		value = 2
		if = {
			limit = {
				has_battle_condition = battle_condition_broken_supply_line
			}
			add = 2
		}
		if = {
			limit = {
				scope:character ?= { experience_level > 5 }
			}
			multiply = 0.5
		}
		else_if = {
			limit = {
				scope:character ?= { experience_level > 4 }
			}
			multiply = 0.5
		}
	}
}

battle_condition_good_communication = {
	icon = "gfx/interface/icons/goods_icons/telephones.dds"

	modifier = {
		unit_morale_damage_mult = 0.10
	}

	possible = {
		exists = scope:character
	}

	weight = {
		value = 2
		if = {
			limit = {
				has_battle_condition = battle_condition_logistics_secured
			}
			add = 2
		}
		if = {
			limit = {
				scope:character ?= { experience_level < 5 }
			}
			multiply = 0.5
		}
		else_if = {
			limit = {
				scope:character ?= { experience_level < 4 }
			}
			multiply = 0.5
		}
	}
}

battle_condition_artillery_barrage = {
    icon = "gfx/interface/icons/goods_icons/artillery.dds"

	modifier = {
		unit_kill_rate_add = 0.2
	}

	possible = {
		scope:is_advancing_side = yes
		exists = scope:character

		scope:character = {
			has_role = general
			OR = {
                commander_military_formation ?= {
                    formation_army_unit_type_fraction = {
                        target = unit_type:combat_unit_type_cannon_artillery
                        value >= 0.05
                    }
                }
                commander_military_formation ?= {
                    formation_army_unit_type_fraction = {
                        target = unit_type:combat_unit_type_mobile_artillery
                        value >= 0.05
                    }
                }
                commander_military_formation ?= {
                    formation_army_unit_type_fraction = {
                        target = unit_type:combat_unit_type_shrapnel_artillery
                        value >= 0.05
                    }
                }
                commander_military_formation ?= {
                    formation_army_unit_type_fraction = {
                        target = unit_type:combat_unit_type_siege_artillery
                        value >= 0.05
                    }
                }
                commander_military_formation ?= {
                   formation_army_unit_type_fraction = {
                      target = unit_type:combat_unit_type_heavy_tank
                      value >= 0.05
                   }
                }
            }
		}
	}

	weight = {
		value = 1
		
		if = {
			limit = {
				has_battle_condition = battle_condition_logistics_secured
			}
			add = 2
		}
		if = {
			limit = {
				has_battle_condition = battle_condition_mud
			}
			add = 2
		}
		if = {
			limit = {
				has_battle_condition = battle_condition_artillery_barrage
				current_manpower > opposite_battle_side.current_manpower
			}
			add = 5
		}
		if = {
			limit = {
				exists = scope:character
				scope:character = {
					OR = {
						has_trait = basic_artillery_commander
						has_trait = experienced_artillery_commander
						has_trait = expert_artillery_commander
					}
				}
			}
			multiply = 5
		}
	}
}

battle_condition_delaying = { #defender only
	icon = "gfx/interface/icons/battle_conditions/battle_condition_delay.dds"

	modifier = {
		unit_morale_loss_mult = -0.2
		unit_morale_damage_mult = -0.2
	}

	possible = {
		scope:is_advancing_side = no
		exists = scope:character
		scope:character = {
			has_role = general
		}
	}


	weight = {
		value = 2
		if = {
			limit = {
				scope:character ?= { experience_level > 5 }
			}
			add = 2
		}
		else_if = {
			limit = {
				scope:character ?= { experience_level > 4 }
			}
			add = 2
		}

		if = {
			limit = {
				current_manpower < opposite_battle_side.current_manpower
			}
			multiply = 2
		}
	}
}

battle_condition_chemical_weapons = {
	icon = "gfx/interface/icons/battle_conditions/battle_condition_chemical_weapons.dds"

	modifier = {
		unit_kill_rate_add = 0.15
		unit_morale_damage_mult = 0.35
		# unit_provinces_captured_mult = -0.25
	}

	possible = {
		exists = scope:character
		scope:character = {
			has_role = general
			commander_military_formation ?= {
                has_mobilization_option = mobilization_option:mobilization_option_chemical_weapons
            }
		}
	}

	weight = {
		value = 10
		
		if = {
			limit = {
				scope:character = {
					has_trait = cruel
				}
			}
			add = 5
		}
		if = {
			limit = {
				scope:character = {
					has_trait = trench_rat
				}
			}
			add = 5
		}
		if = {
			limit = {
				scope:character = {
					has_trait = pillager
				}
			}
			add = 5
		}
		if = {
			limit = {
				scope:character = {
					has_trait = ruthless
				}
			}
			add = 5
		}
		if = {
			limit = {
				scope:opposite_battle_side ?= {
					has_battle_condition = battle_condition_chemical_defence
				}
			}
			multiply = 0.01
		}
	}
}

battle_condition_chemical_defence = {
	icon = "gfx/interface/icons/battle_conditions/battle_condition_chemical_defence.dds"

	modifier = {
		unit_morale_loss_mult = -0.35
	}

	possible = {
		# NOR = {
		# 	has_battle_condition = battle_condition_panicked_retreat
		# 	has_battle_condition = battle_condition_controlled_retreat
		# }
		opposite_battle_side = {
			has_battle_condition = battle_condition_chemical_weapons
		}
		exists = scope:character
		scope:character = {
			owner = {
				has_technology_researched = chemical_warfare
			}
		}
	}

	weight = {
		value = 1
		if = {
			limit = {
				opposite_battle_side = {
					has_battle_condition = battle_condition_chemical_weapons
				}
			}
			multiply = 100
		}
	}
}

